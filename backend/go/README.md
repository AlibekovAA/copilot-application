# Go Backend - Authentication

Go-микросервис для аутентификации пользователей, управления профилями и безопасного взаимодействия с фронтендом.

## Возможности

- **JWT-аутентификация** — безопасная авторизация через токены с 72-часовым сроком действия
- **Регистрация и вход** — создание аккаунта и аутентификация по email и паролю
- **Управление профилем** — просмотр профиля и изменение пароля
- **Безопасность** — хеширование паролей с использованием `bcrypt`
- **PostgreSQL поддержка** — работа с базой данных через `sqlx`
- **Middleware архитектура** — CORS и JWT-аутентификация как декораторы маршрутов
- **Гибкая конфигурация** — настройка через `.env` и структурированные конфиги
- **Структурированное логирование** — ротация логов с `lumberjack`, уровни логирования
- **Graceful shutdown** — корректное завершение работы при остановке контейнера
- **Docker ready** — готов к развертыванию в контейнере и интеграции в Docker Compose

## Структура проекта

| Путь                       | Описание                             |
| -------------------------- | ------------------------------------ |
| main.go                    | Точка входа приложения               |
| application/               | Логика приложения и HTTP-обработчики |
| application/application.go | Инициализация и запуск сервера       |
| application/handlers.go    | Обработчики эндпоинтов               |
| application/jwt.go         | Генерация и валидация JWT            |
| config/                    | Загрузка конфигурации из .env        |
| database/                  | Работа с PostgreSQL                  |
| logger/                    | Структурированное логирование        |
| Dockerfile                 | Docker-образ                         |
| go.mod / go.sum            | Управление зависимостями             |

## Установка и настройка

### Требования

- Go 1.24+
- PostgreSQL
- `.env` файл с переменными окружения

### Локальный запуск

```bash
cd backend/go

go run main.go
```

## Эндпоинты API

| Метод | Путь                   | Описание                        | Требует токена |
| ----- | ---------------------- | ------------------------------- | -------------- |
| GET   | `/health`              | Проверка работоспособности      | Нет            |
| POST  | `/register`            | Регистрация нового пользователя | Нет            |
| POST  | `/login`               | Получение JWT-токена            | Нет            |
| GET   | `/api/profile`         | Получение данных профиля        | Да             |
| POST  | `/api/change-password` | Смена пароля                    | Да             |

### Пример запроса на регистрацию

```http
POST /register
Content-Type: application/json

{
  "email": "ivan@example.com",
  "password": "secure_password",
  "name": "Иван Василов"
}
```

**Ответ:**

```json
{
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "user": {
    "id": 123,
    "email": "ivan@example.com",
    "name": "Иван Василов"
  }
}
```

### Пример запроса на вход

```http
POST /login
Content-Type: application/json

{
  "email": "ivan@example.com",
  "password": "secure_password"
}
```

**Ответ:**

```json
{
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "user": {
    "id": 123,
    "email": "ivan@example.com",
    "name": "Иван Василов"
  }
}
```

### Пример использования защищённого эндпоинта

```http
GET /api/profile
Authorization: Bearer <your_jwt_token>
```

**Ответ:**

```json
{
  "user_id": 123,
  "email": "ivan@example.com"
}
```

## Логирование

Логи пишутся в консоль и в файл `app.log` в указанной директории (`LOG_DIR`). Поддерживаются уровни:
`DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`.

## Поддержка CORS

Разрешены следующие источники:

- `http://localhost:3000`
- `http://frontend_app:3000`

Настройка CORS — в функции `corsMiddleware`.
